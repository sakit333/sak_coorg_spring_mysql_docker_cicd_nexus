pipeline {
    agent any
    parameters {
        choice(name: 'ACTION', choices: ['start', 'stop', 'terminate'], description: 'Choose what to do with the Nexus Repository container')
    }
    environment {
        COMPOSE_FILE = 'nexus_repo_docker/docker-compose.yml'
    }
    stages {
        stage('Build Nexus Image') {
            when { expression { params.ACTION == 'start' } }
            steps {
                echo "üõ†Ô∏è Building Nexus Repository image..."
                sh 'sudo docker-compose -f ${COMPOSE_FILE} build nexus'
            }
        }
        stage('Start Nexus Container') {
            when { expression { params.ACTION == 'start' } }
            steps {
                echo "üöÄ Starting Nexus Repository container..."
                sh 'sudo docker-compose -f ${COMPOSE_FILE} up -d nexus'
            }
        }
        stage('Stop Nexus Container') {
            when { expression { params.ACTION == 'stop' } }
            steps {
                echo "üõë Stopping Nexus Repository container..."
                sh 'sudo docker-compose -f ${COMPOSE_FILE} stop nexus'
            }
        }
        stage('Terminate Nexus Container') {
            when { expression { params.ACTION == 'terminate' } }
            steps {
                echo "‚ùå Removing Nexus Repository container and volume..."
                sh 'sudo docker-compose -f ${COMPOSE_FILE} down -v'
            }
        }
        stage('Show Nexus Status') {
            steps {
                echo "üì¶ Nexus Repository container status:"
                sh 'sudo docker-compose -f ${COMPOSE_FILE} ps'
            }
        }
    }
    post {
        success {
            echo "‚úÖ Pipeline completed successfully for action: '${params.ACTION}'"
        }
        failure {
            echo "‚ùå Pipeline failed during action: '${params.ACTION}'"
        }
        always {
            echo "‚ÑπÔ∏è Pipeline finished. Check logs above for details."
        }
    }
}
